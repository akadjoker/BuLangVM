cmake_minimum_required(VERSION 3.10)
project(box2d)

# Box2D 2.4.x build configuration
# Clone Box2D into this folder:
#   git clone https://github.com/erincatto/box2d.git .
# Or download from: https://github.com/erincatto/box2d/releases

set(CMAKE_CXX_STANDARD 17)

# Check if Box2D sources exist
if(NOT EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/src/box2d.h" AND
   NOT EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/include/box2d/box2d.h")
    message(FATAL_ERROR
        "Box2D sources not found!\n"
        "Please clone Box2D into external/box2d:\n"
        "  cd external/box2d\n"
        "  git clone https://github.com/erincatto/box2d.git .\n"
        "Or download from: https://github.com/erincatto/box2d/releases")
endif()

# Box2D 2.4+ has its own CMakeLists.txt
# We just configure options and include it
set(BOX2D_BUILD_UNIT_TESTS OFF CACHE BOOL "" FORCE)
set(BOX2D_BUILD_TESTBED OFF CACHE BOOL "" FORCE)
set(BOX2D_BUILD_DOCS OFF CACHE BOOL "" FORCE)
set(BOX2D_USER_SETTINGS OFF CACHE BOOL "" FORCE)

# If Box2D has its own CMakeLists, use it
if(EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/CMakeLists.txt.box2d")
    # Renamed original to avoid recursion
    include(CMakeLists.txt.box2d)
elseif(EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/src/CMakeLists.txt")
    add_subdirectory(src)
else()
    # Manual build for Box2D 2.4.x structure
    file(GLOB_RECURSE BOX2D_SOURCES
        "${CMAKE_CURRENT_SOURCE_DIR}/src/*.cpp"
    )

    add_library(box2d STATIC ${BOX2D_SOURCES})

    target_include_directories(box2d PUBLIC
        ${CMAKE_CURRENT_SOURCE_DIR}/include
    )

    if(UNIX)
        target_compile_options(box2d PRIVATE -fPIC)
    endif()
endif()
