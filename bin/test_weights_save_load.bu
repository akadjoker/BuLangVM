// ============================================
// TESTE SAVE/LOAD PESOS COM NÃšMEROS DUMMY
// ============================================

import file;

class SimpleNN
{
    var size;
    var weights;
    
    def init(size)
    {
        self.size = size;
        self.weights = [];
        
        // Criar pesos dummy
        for (var i = 0; i < size; i = i + 1)
        {
            self.weights.push((i + 1) * 0.5);  // 0.5, 1.0, 1.5, 2.0, ...
        }
    }
    
    def save_to_file(filename)
    {
        print(format("ðŸ’¾ Salvando {} pesos em {}", len(self.weights), filename));
        
        var f = file.open(filename, "w");
        
        // Salvar tamanho
        file.write_int(f, self.size);
        print(format("  - Tamanho: {}", self.size));
        
        // Salvar cada peso como double
        for (var i = 0; i < len(self.weights); i = i + 1)
        {
            file.write_double(f, self.weights[i]);
            print(format("  - Peso[{}]: {}", i, self.weights[i]));
        }
        
        file.close(f);
        print("âœ… Arquivo salvo com sucesso!");
    }
    
    def load_from_file(filename)
    {
        print(format("ðŸ“– Carregando pesos de {}", filename));
        
        var f = file.open(filename, "r");
        
        // Carregar tamanho
        self.size = file.read_int(f);
        print(format("  - Tamanho carregado: {}", self.size));
        
        // Carregar pesos
        self.weights = [];
        for (var i = 0; i < self.size; i = i + 1)
        {
            var weight = file.read_double(f);
            self.weights.push(weight);
            print(format("  - Peso[{}]: {}", i, weight));
        }
        
        file.close(f);
        print("âœ… Arquivo carregado com sucesso!");
    }
    
    def print_weights()
    {
        print("\nðŸ“Š Pesos Atuais:");
        for (var i = 0; i < len(self.weights); i = i + 1)
        {
            print(format("  Peso[{}] = {}", i, self.weights[i]));
        }
        print("");
    }
}

// ============================================
// TESTE PRINCIPAL
// ============================================

print("ðŸ§ª TESTE DE SAVE/LOAD DE PESOS\n");

// 1. Criar rede neural dummy com 5 pesos
print("1ï¸âƒ£  Criando rede com 5 pesos dummy:");
var nn1 = SimpleNN(5);
nn1.print_weights();

// 2. Salvar em arquivo
print("2ï¸âƒ£  Salvando pesos em 'test_weights_dummy.nn':");
nn1.save_to_file("test_weights_dummy.nn");

// 3. Criar nova rede vazia
print("\n3ï¸âƒ£  Criando nova rede (vazia):");
var nn2 = SimpleNN(0);
nn2.print_weights();

// 4. Carregar pesos do arquivo
print("4ï¸âƒ£  Carregando pesos de 'test_weights_dummy.nn':");
nn2.load_from_file("test_weights_dummy.nn");
nn2.print_weights();

// 5. Verificar se sÃ£o iguais
print("5ï¸âƒ£  Verificando se pesos sÃ£o iguais:");
var equal = true;
if (len(nn1.weights) != len(nn2.weights))
{
    equal = false;
    print("âŒ Tamanhos diferentes!");
}
else
{
    for (var i = 0; i < len(nn1.weights); i = i + 1)
    {
        if (nn1.weights[i] != nn2.weights[i])
        {
            equal = false;
            print(format("âŒ Peso[{}] diferente: {} vs {}", i, nn1.weights[i], nn2.weights[i]));
        }
    }
}

if (equal)
{
    print("âœ… SUCESSO! Todos os pesos foram salvos e carregados corretamente!");
}
else
{
    print("âŒ FALHA! Pesos nÃ£o coincidem!");
}

print("\nâœ¨ Teste concluÃ­do!");
