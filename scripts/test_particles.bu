// Particle logic test (no rendering)

print("=== Particle Logic Test ===");

def assert(cond, msg)
{
    if (!cond)
    {
        print("ASSERT FAIL:", msg);
    }
}

class Particle
{
    var x = 0.0;
    var y = 0.0;
    var vx = 0.0;
    var vy = 0.0;
    var life = 0.0;

    def init(px, py, pvx, pvy, plife)
    {
        self.x = px;
        self.y = py;
        self.vx = pvx;
        self.vy = pvy;
        self.life = plife;
    }

    def update(dt)
    {
        self.x = self.x + (self.vx * dt);
        self.y = self.y + (self.vy * dt);
        self.life = self.life - dt;
        return self.life > 0;
    }
}

class ParticleSystem
{
    var particles;

    def init()
    {
        self.particles = [];
    }

    def emit(count)
    {
        var i = 0;
        while (i < count)
        {
            // Spawn with simple pattern to test arrays + classes
            var p = Particle(i * 1.0, i * 2.0, 1.0, 0.5, 1.0);
            self.particles.push(p);
            i = i + 1;
        }
    }

    def update(dt)
    {
        var alive = [];
        var i = 0;
        while (i < len(self.particles))
        {
            var p = self.particles[i];
            if (p.update(dt))
            {
                alive.push(p);
            }
            i = i + 1;
        }
        self.particles = alive;
    }

    def count()
    {
        return len(self.particles);
    }
}

var ps = ParticleSystem();
ps.emit(5);
assert(ps.count() == 5, "emit count");

ps.update(0.25);
assert(ps.count() == 5, "still alive after 0.25s");
assert(ps.particles[0].x > 0, "particle moved x");
assert(ps.particles[0].y > 0, "particle moved y");

ps.update(0.80);
assert(ps.count() == 0, "all dead after 1.05s total");

print("=== Particle Logic Test Done ===");
